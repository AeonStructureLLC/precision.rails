<!DOCTYPE html>
<html>
<head>
  <title>PrecisionRails</title>
  <script type="text/javascript" src="/javascripts/jquery-1.7.1.min.js"></script>
  <script type="text/javascript" src="/javascripts/jquery-ui-1.9.2.custom.min.js"></script>
  <script type="text/javascript" src="/javascripts/jquery.dependClass.js"></script>
  <script type="text/javascript" src="/javascripts/rails.js"></script>
  <script type="text/javascript" src="/javascripts/jquery.ui.touch-punch.js"></script>
  <script type="text/javascript" src="/javascripts/underscore-min.js"></script>
  <script type="text/javascript" src="/javascripts/backbone-min.js"></script>
  <script type="text/javascript" src="/javascripts/moment.min.js"></script>
  <script type="text/javascript" src="/javascripts/jquery.total-storage.min.js"></script>
  <script type="text/javascript" src="/javascripts/json2.js"></script>
  <script type="text/javascript" src="/javascripts/jquery.tinysort.min.js"></script>
  <!--<script type="text/javascript" src="/javascripts/jquery.nestable.js"></script>-->
  <script type="text/javascript" src="/javascripts/jquery.scrollTo.min.js"></script>
  <script type="text/javascript" src="/javascripts/precision.js?<%= rand(99999) %>"></script>

  <%= csrf_meta_tags %>

  <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
  <META HTTP-EQUIV="Expires" CONTENT="-1">

  <link href="/stylesheets/jquery-ui-1.9.2.custom.min.css" media="screen" rel="stylesheet" type="text/css" />

  <link href="/stylesheets/precision.less?<%= rand(99999) %>" media="screen" rel="stylesheet/less" type="text/css" />
  <link href="/stylesheets/print.less?<%= rand(99999) %>" media="print" rel="stylesheet/less" type="text/css" />
  <script type="text/javascript" src="/javascripts/less-1.3.0.min.js"></script>
  <script>

    <% if Rails.env == 'development' %>
      var rails_environment = "development";
    <% else %>
      var rails_environment = "production";
    <% end %>

    var CurrentUser = <%= current_user.to_json.html_safe %>;

    $(document).ready(function(){
      less.watch();
      updateCartCount();
    });

    $(document).off('click', '#CurrentCart');
    $(document).on('click', '#CurrentCart', function(){
      var current_cart_wrapper = $("#CurrentCartWrapper");
      if(current_cart_wrapper.hasClass('hidden')){
        current_cart_wrapper.removeClass('hidden');
      } else {
        current_cart_wrapper.addClass('hidden');
      }
    });

    $(document).off('click', '#AeonModalBlocker');
    $(document).on('click', '#AeonModalBlocker', function(){
      $("#AeonModalBlocker").addClass('hidden');
      $('.aeon_modal').addClass('hidden');
    });

    function updateCartCount(){
      var quantities = $("#CurrentCartWrapper").find(".quantity");
      var total_quantity = 0;
      _.each(quantities, function(quantity){
        var quantity_ui = $(quantity);
        total_quantity = total_quantity + Number(quantity_ui.attr('value'));
      });
      $("#CartItemsCount").html(total_quantity);
    }
  </script>
  <%= yield :head %>
</head>
<body>

<%= render :partial => '/shared/navigation' %>
<div id="CurrentCartWrapper" class="hidden">
  <%= render :partial => '/carts/cart_item_list' %>
</div>


<div id="ContentContainer">
  <%= yield %>
</div>

<div id="AeonModalBlocker" class="hidden"></div>

</body>
</html>
